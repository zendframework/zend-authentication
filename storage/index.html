<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="zend-authentication">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Identity Persistence - zend-authentication</title>

    <link rel="stylesheet" href="../css/styles-18b942728f.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
</head>
<body id="page-top">

    
    <div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">

            
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="../img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">

            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>

            
            
                <div class="nav navbar-nav navbar-collapse visible-xs-block ">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="">zend-authentication</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            
                
                    <li class="subnavigation__list-item ">
                        <a href="" class="subnavigation__link">zend-authentication</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item ">
                        <a href="intro/" class="subnavigation__link">Intro</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">Adapters</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="adapter/intro/" class="subnavigation__link">Intro</a>
    </li>

                            
                                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">DbTable</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="adapter/dbtable/intro/" class="subnavigation__link">Intro</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="adapter/dbtable/credential-treatment/" class="subnavigation__link">CredentialTreatmentAdapter</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="adapter/dbtable/callback-check/" class="subnavigation__link">CallbackCheck</a>
    </li>

            
        </ul>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="adapter/digest/" class="subnavigation__link">Digest</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="adapter/http/" class="subnavigation__link">HTTP</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="adapter/ldap/" class="subnavigation__link">LDAP</a>
    </li>

                            
                        </ul>
                    </li>
                
            
                
                    <li class="subnavigation__list-item subnavigation__list-item--active">
                        <a href="storage/" class="subnavigation__link">Identity Persistence</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item ">
                        <a href="validator/" class="subnavigation__link">Validation</a>
                    </li>
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="nav navbar-nav navbar-collapse visible-xs-block">
                <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</div>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation

                    
                        <small class="header__subtitle">zend-authentication</small>
                    
                </h1>
            </div>

            
            <div class="col-xs-4 text-right">
                
                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/zendframework/zend-authentication/" class="header__link header__link--github" title="Go to repository of zend-authentication">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="laminas-announcement">
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                Zend Framework transitions to the Linux Foundation. <a href="https://getlaminas.org">Learn More.</a>
            </div>
        </div>
    </div>
</div>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-xs-12 content" role="main">
            <!-- content:begin -->
                
                    <ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
    <li><a href="https://framework.zend.com/">Home</a></li>

    
        <li><a href="https://docs.zendframework.com/">Documentation</a></li>

        
            <li><a href="">zend-authentication</a></li>

            

            <li class="active">Identity Persistence</li>
        
    
</ol>


    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">In This Article</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#default-persistence-in-the-php-session" class="toc__link">Default Persistence in the PHP Session</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#modifying-the-session-namespace" class="toc__link">Modifying the Session Namespace</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#chain-storage" class="toc__link">Chain Storage</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#implementing-custom-storage" class="toc__link">Implementing Custom Storage</a>
                    </li>
                
            </ul>
        </div>
    


    <h1 id="identity-persistence">Identity Persistence</h1>
<p>Authenticating a request that includes authentication credentials is useful, but
it is also often useful to persist the authenticated identity between requests, so
the user does not need to provide credentials with each request.</p>
<p>HTTP is a stateless protocol; however, techniques such as cookies and sessions
have been developed in order to facilitate maintaining state across multiple
requests in server-side web applications.</p>
<h2 id="default-persistence-in-the-php-session">Default Persistence in the PHP Session</h2>
<p>By default, zend-authentication provides persistent storage of the identity from a successful
authentication attempt using PHP session facilities. Upon a successful authentication attempt,
<code>Zend\Authentication\AuthenticationService::authenticate()</code> stores the identity from the
authentication result into persistent storage. Unless specified otherwise,
<code>Zend\Authentication\AuthenticationService</code> uses a storage class named
<code>Zend\Authentication\Storage\Session</code>, which depends on
<a href="https://github.com/zendframework/zend-session">zend-session</a>.</p>
<p>You may also implement <code>Zend\Authentication\Storage\StorageInterface</code>, and
provide your implementation to <code>Zend\Authentication\AuthenticationService::setStorage()</code>.</p>
<blockquote>
<h3 id="bypass-the-authenticationservice">Bypass the AuthenticationService</h3>
<p>If automatic persistent storage of the identity is not appropriate for your
use case, you can skip usage of <code>Zend\Authentication\AuthenticationService</code>
altogether, and instead use an adapter directly.</p>
</blockquote>
<h2 id="modifying-the-session-namespace">Modifying the Session Namespace</h2>
<p><code>Zend\Authentication\Storage\Session</code> uses the session namespace <code>Zend_Auth</code>.
This namespace may be overridden by passing a different value to the constructor
of <code>Zend\Authentication\Storage\Session</code>, and this value is internally passed
along to the constructor of <a href="https://github.com/zendframework/zend-session">Zend\Session\Container</a>.
This should occur before authentication is attempted, since
<code>Zend\Authentication\AuthenticationService::authenticate()</code> injects the
authenticated identity into the configured storage.</p>
<pre class="codehilite"><code class="language-php">use Zend\Authentication\AuthenticationService;
use Zend\Authentication\Storage\Session as SessionStorage;

$auth = new AuthenticationService();

// Use 'someNamespace' instead of 'Zend_Auth'
$auth-&gt;setStorage(new SessionStorage('someNamespace'));

// Set up the auth adapter, $authAdapter
$authAdapter = /* ... */;

// Authenticate, saving the result, and persisting the identity on success:
$result = $auth-&gt;authenticate($authAdapter);</code></pre>

<h2 id="chain-storage">Chain Storage</h2>
<p>A website might use multiple storage strategies for identity persistence; the
<code>Chain</code> Storage can be used to glue these together.</p>
<p>For example, the <code>Chain</code> can be configured to first use <code>Session</code> storage and
then use an <code>OAuth</code> storage adapter. One could configure this in the following
way:</p>
<pre class="codehilite"><code class="language-php">$storage = new Chain;
$storage-&gt;add(new Session);
$storage-&gt;add(new OAuth);   // Note: imaginary storage, not part of zend-authentication</code></pre>

<p>When the <code>Chain</code> Storage is used, its underlying storage adapters will be
consulted in the order in which they were added to the chain. Using our scenario
above, the <code>Session</code> storage adapter will be consulted first. When that happens:</p>
<ul>
<li>If the <code>Session</code> storage is non-empty, the <code>Chain</code> will use and return its
  contents.</li>
<li>If the <code>Session</code> storage is empty, the <code>Chain</code> will move on to the <code>OAuth</code>
  storage adapter.</li>
<li>If the <code>OAuth</code> storage is empty, the <code>Chain</code> will return an empty result.</li>
<li>If the <code>OAuth</code> storage is non-empty, the <code>Chain</code> will use and return its
  contents. However, it will <em>also</em> populate all storage adapters with higher
  priority with the contents; in our example, the <code>Session</code> storage will be
  populated, but if we'd added any adapters after the <code>OAuth</code> adapter, they
  would not.</li>
</ul>
<p>The priority of storage adapters in the Chain can be made explicit via the
<code>Chain::add</code> method, which accepts a second argument indicating the priority.
(Per standard priority queue usage, higher values have higher priority, and
lower or negative values have lower priority.)</p>
<pre class="codehilite"><code class="language-php">$chain-&gt;add(new A, 2);
$chain-&gt;add(new B, 10); // B will be used first</code></pre>

<h2 id="implementing-custom-storage">Implementing Custom Storage</h2>
<p>Sometimes developers may need to use a different identity storage mechanism than
that provided by <code>Zend\Authentication\Storage\Session</code>. To do so, implement
<code>Zend\Authentication\Storage\StorageInterface</code> and supply an instance of your
implementation to <code>Zend\Authentication\AuthenticationService::setStorage()</code>.</p>
<p>The following examples demonstrate the process.</p>
<p>First, implement <code>Zend\Authentication\Storage\StorageInterface</code>:</p>
<pre class="codehilite"><code class="language-php">&lt;?php
namespace My;

use Zend\Authentication\Storage\StorageInterface;

class Storage implements StorageInterface
{
    /**
     * Returns true if and only if storage is empty.
     *
     * @return boolean
     * @throws \Zend\Authentication\Exception\ExceptionInterface If it is
     *     impossible to determine whether storage is empty.
     */
    public function isEmpty()
    {
        /**
         * @todo implementation
         */
    }

    /**
     * Returns the contents of storage.
     *
     * Behavior is undefined when storage is empty.
     *
     * @return mixed
     * @throws \Zend\Authentication\Exception\ExceptionInterface If reading
     *     contents from storage is impossible
     */

    public function read()
    {
        /**
         * @todo implementation
         */
    }

    /**
     * Writes $contents to storage.
     *
     * @param  mixed $contents
     * @return void
     * @throws \Zend\Authentication\Exception\ExceptionInterface If writing
     *     $contents to storage is impossible
     */

    public function write($contents)
    {
        /**
         * @todo implementation
         */
    }

    /**
     * Clears contents from storage.
     *
     * @return void
     * @throws \Zend\Authentication\Exception\ExceptionInterface If clearing
     *     contents from storage is impossible.
     */

    public function clear()
    {
        /**
         * @todo implementation
         */
    }
}</code></pre>

<p>In order to use this custom storage class, <code>Zend\Authentication\AuthenticationService::setStorage()</code>
is invoked before an authentication query is attempted:</p>
<pre class="codehilite"><code class="language-php">use My\Storage;
use Zend\Authentication\AuthenticationService;

// Create the authentication service instance:
$auth = new AuthenticationService();

// Instruct the authentication service to use the custom storage class:
$auth-&gt;setStorage(new Storage());

// Create the authentication adapter:
$adapter = /* ... */;

// Authenticate, saving the result, and persisting the identity on success:
$result = $auth-&gt;authenticate($adapter);</code></pre>



    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="adapter/ldap/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="validator/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>



    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/zendframework/zend-authentication/edit/master/docs/book/storage.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            <!-- content:end -->
            </div>
            <div class="col-md-3 col-xs-12 sidebar">
                
                    <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="">zend-authentication</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            
                
                    <li class="subnavigation__list-item ">
                        <a href="" class="subnavigation__link">zend-authentication</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item ">
                        <a href="intro/" class="subnavigation__link">Intro</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">Adapters</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="adapter/intro/" class="subnavigation__link">Intro</a>
    </li>

                            
                                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">DbTable</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="adapter/dbtable/intro/" class="subnavigation__link">Intro</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="adapter/dbtable/credential-treatment/" class="subnavigation__link">CredentialTreatmentAdapter</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="adapter/dbtable/callback-check/" class="subnavigation__link">CallbackCheck</a>
    </li>

            
        </ul>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="adapter/digest/" class="subnavigation__link">Digest</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="adapter/http/" class="subnavigation__link">HTTP</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="adapter/ldap/" class="subnavigation__link">LDAP</a>
    </li>

                            
                        </ul>
                    </li>
                
            
                
                    <li class="subnavigation__list-item subnavigation__list-item--active">
                        <a href="storage/" class="subnavigation__link">Identity Persistence</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item ">
                        <a href="validator/" class="subnavigation__link">Validation</a>
                    </li>
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>&copy; 2006-2018 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.zendframework.com" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://zendframework-slack.herokuapp.com" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://tinyletter.com/mwopzend" class="support__link" title="Newsletter"><i class="fa fa-envelope"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://framework.zend.com/blog/feed-rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://framework.zend.com/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script>
        var base_url = '..',
            siteName = 'zend-authentication';
    </script>
    <script src="../js/"></script>
        <script src="../search/main.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

<script>
// Anchors
anchors.options.placement = 'left';
anchors.add(
    '.content h1:not(.content__title), .content h2, .content > h3, .content h4, .content h5'
);
</script>



</body>


</html>
